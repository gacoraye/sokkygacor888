<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Slot 5x4</title>
<style>
html, body { margin:0; padding:0; overflow:hidden; height:100%; background:#111; color:#fff; font-family:Arial,sans-serif; display:flex; justify-content:center; align-items:center; }

.game-box{ position:relative; width:340px; height:520px; background: url('SLOT MACHINE.png') no-repeat center center; background-size: cover; /* membuat gambar memenuhi box */border-radius:5px; box-sizing:border-box; overflow:hidden; }

.slot{ position:absolute; top:110px; left:10px; width:320px; height:260px; display:grid; grid-template-columns:repeat(5,60px); gap:5px; box-sizing:border-box; }

.reel{ width:60px; height:260px; overflow:hidden; background:#aaa; border-radius:5px; position:relative; }
.reel.hover{ box-shadow:0 0 20px 6px #00ff99; }

.cell{ height:65px; font-size:32px; display:flex; align-items:center; justify-content:center; }

.slot-overlay { position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:1; }

.balance-box{ position:absolute; top:390px; left:10px; }
.balance-chip{ width:100px; height:30px; display:flex; align-items:center; gap:6px; border:2px solid #00ff99; border-radius:5px; background:#111; color:#fff; font-size:14px; font-weight:bold; box-sizing:border-box; }
.balance-chip span{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

.auto-spin-btn{ position:absolute; top:390px; left:115px; width:35px; height:30px; border:2px solid #00ff99; border-radius:5px; background:#111; color:#fff; font-size:14px; cursor:pointer; font-weight:bold; }
.auto-spin-btn.disabled{ background:#555; cursor:not-allowed; }

.bet-buttons{ position:absolute; top:390px; left:155px; display:flex; gap:5px; }
.bet-buttons button{ width:40px; height:30px; font-size:14px; border:2px solid #00ff99; border-radius:5px; background:#111; color:#fff; cursor:pointer; font-weight:bold; }
.bet-buttons .active{ background:#00ff99; color:#000; }

.free-spin-box{ position:absolute; top:425px; left:20px; width:150px; height:30px; display:flex; align-items:center; justify-content:flex-start; gap:5px; border:2px solid #00ff99; border-radius:5px; background:#111; box-sizing:border-box; overflow:hidden; }
.free-spin-btn{ width:40px; height:30px; border:3px solid #00ff99; border-radius:6px; background:#00a764; color:#fff; font-size:12px; cursor:pointer; font-weight:bold; margin:0; }
.free-spin-btn.active{ background:#00ff99; color:#000; }
#freeSpinDisplay{ font-weight:bold; font-size:12px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

.spin-btn{ position:absolute; top:427.5px; left:177.5px; width:145px; height:50px; padding:12px 0; font-size:20px; font-weight:bold; border:none; border-radius:5px; background:gold; cursor:pointer; }
.spin-btn.disabled{ background:red; cursor:not-allowed; }

#winFloat {
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, 0);
    color: #00ff99;
    font-weight: bold;
    opacity: 0;
    transition: transform 1s ease-out, opacity 1s ease-out;
    pointer-events: none;
    white-space: nowrap;
    z-index: 10;
}
.WARNING {
    position: absolute;
    bottom: 5px;           /* jarak dari atas game-box */
    width: 100%;
    text-align: center;   /* teks di tengah */
    font-size: 10px;
    font-weight: bold;
    color: rgb(255, 0, 0);          /* warna teks */
    text-shadow: 1px 1px 4px #6b0000; /* membuat teks lebih terlihat */
    pointer-events: none; /* supaya tidak mengganggu tombol */
    z-index: 5;           /* di atas background tapi di bawah overlay slot */
}

</style>
</head>
<body>
<div class="game-box">
  <div class="slot" id="slot">
    <img src="SLOT MACHINE overlay1.png" alt="Overlay" class="slot-overlay">
  </div>

  <div class="balance-box">
    <div class="balance-chip" style="position:relative;">
      üí∞ <span id="balance"></span>
      <span id="winFloat"></span>
    </div>
  </div>

  <button class="auto-spin-btn" id="autoSpinBtn" onclick="cycleAutoSpin()">x1</button>

  <div class="bet-buttons">
    <button onclick="setBet(100)">100</button>
    <button onclick="setBet(400)">400</button>
    <button onclick="setBet(1000)" class="active">1k</button>
    <button onclick="setBet(20000)">20k</button>
  </div>

  <div class="free-spin-box">
    <button id="toggleFreeSpin" class="free-spin-btn active" onclick="toggleFreeSpin()">ON</button>
    <span id="freeSpinDisplay"></span>
  </div>

  <button class="spin-btn" id="spinBtn" onclick="spinAuto()">SPIN</button>
</div>

<audio id="spinSound" src="slotspin.mp3" preload="auto"></audio>
<audio id="spinStartSound" src="slotspin.mp3" preload="auto"></audio>

<div class="WARNING">HANYA SEBAGAI PROMOSI WEB DESIGNER!!!</div>
<script>
const SPIN_DURATION=1200;
const rows=4, cols=5, cellH=65;
const symbols=["üçí","üçã","üçâ","üîî","üíé","üÉè","‚≠ê"];
const symbolPayout={"üçí":2,"üçã":3,"üçâ":5,"üîî":1,"üíé":20,"üÉè":1,"‚≠ê":1};
const lineBonus={3:1234,4:21012,5:123321};
let spinMode = "W"; // "W" = menang, "L" = kalah, "N" = random

function setSpinMode(mode){
    if(["L","W","N"].includes(mode)){
        spinMode = mode;
        console.log("Spin mode diubah ke:", spinMode);
    } else {
        console.warn("Mode tidak valid. Gunakan 'L', 'W', atau 'N'.");
    }
}

let balance=10000, bet=1000, freeSpins=0, useFreeSpin=true;
let autoSpinModes=[1,4,9], autoSpinIndex=0, isAutoSpinning=false;
let extraFreeSpinEnabled = true;

const slot=document.getElementById("slot");
const reels=[], balanceEl=document.getElementById("balance"), winFloat=document.getElementById("winFloat");
const freeSpinDisplay=document.getElementById("freeSpinDisplay");
const spinBtn=document.getElementById("spinBtn"), autoSpinBtn=document.getElementById("autoSpinBtn"), toggleFreeSpinBtn=document.getElementById("toggleFreeSpin");
const betButtons=document.querySelectorAll(".bet-buttons button");

// Setup reels
for(let c=0;c<cols;c++){
  const reel=document.createElement("div"); reel.className="reel";
  const inner=document.createElement("div");
  for(let i=0;i<rows*15;i++){
    const cell=document.createElement("div"); cell.className="cell";
    cell.textContent=symbols[Math.floor(Math.random()*symbols.length)];
    inner.appendChild(cell);
  }
  reel.appendChild(inner);
  slot.appendChild(reel);
  reels.push(inner);
}

// Set Bet
function setBet(v){
  bet=v;
  betButtons.forEach(b=>b.classList.remove("active"));
  [...betButtons].find(b=>{
    if(b.textContent.replace("k","000")==v.toString()){ b.classList.add("active"); return true; }
  });
}

// Toggle FreeSpin
function toggleFreeSpin(){
  if(freeSpins <= 0){
    useFreeSpin=false;
    toggleFreeSpinBtn.classList.remove('active');
    toggleFreeSpinBtn.textContent="OFF";
    toggleFreeSpinBtn.disabled=true;
    toggleFreeSpinBtn.style.opacity=0.5;
    return;
  }
  useFreeSpin=!useFreeSpin;
  toggleFreeSpinBtn.classList.toggle('active', useFreeSpin);
  toggleFreeSpinBtn.textContent = useFreeSpin?"ON":"OFF";
}

// AutoSpin cycle
function cycleAutoSpin(){ 
  if(autoSpinBtn.classList.contains("disabled")) return;
  autoSpinIndex=(autoSpinIndex+1)%autoSpinModes.length;
  autoSpinBtn.textContent="x"+autoSpinModes[autoSpinIndex]; 
}

// Spin Auto
function spinAuto(){
  if(isAutoSpinning) return;
  toggleFreeSpinBtn.disabled=true; toggleFreeSpinBtn.style.opacity=0.5;
  let spins=autoSpinModes[autoSpinIndex];
  if(balance<bet*spins && (!useFreeSpin||freeSpins===0)){ highlightBalance(); toggleFreeSpinBtn.disabled=false; toggleFreeSpinBtn.style.opacity=1; return; }
  isAutoSpinning=true; spinBtn.classList.add("disabled"); spinBtn.style.background="red"; autoSpinBtn.classList.add("disabled");

  let remainingSpins = spins;
  autoSpinBtn.textContent = "x" + remainingSpins;

  (function loop(){
    if(remainingSpins > 0){
      spinStep();
      remainingSpins--;
      autoSpinBtn.textContent = "x" + remainingSpins;
      setTimeout(loop, SPIN_DURATION+100);
    } else {
      isAutoSpinning=false;
      spinBtn.classList.remove("disabled"); spinBtn.style.background="gold"; autoSpinBtn.classList.remove("disabled");
      toggleFreeSpinBtn.disabled=false; toggleFreeSpinBtn.style.opacity=1;
      autoSpinBtn.textContent = "x"+autoSpinModes[autoSpinIndex];
      clearReelGlow();
    }
  })();
}

// Spin step
function spinStep(){
  if(useFreeSpin && freeSpins>0) freeSpins--;
  else{
    if(balance < bet){ highlightBalance(); return; }
    balance -= bet;
  }

  document.getElementById("spinStartSound").currentTime = 0;
  document.getElementById("spinStartSound").play();

  const spinAudio = document.getElementById("spinSound");
  spinAudio.currentTime = 0;
  spinAudio.playbackRate = spinAudio.duration / (SPIN_DURATION/1000);
  spinAudio.play();
  setTimeout(()=>{ spinAudio.pause(); spinAudio.currentTime = 0; }, SPIN_DURATION);

  updateBalance(); 
  updateFreeSpinDisplay();

  reels.forEach((reel, c)=>{
      reel.style.transition=`transform ${SPIN_DURATION/1000}s ease-out`;
      let stop = Math.floor(Math.random()*(reel.children.length-rows));
      reel.dataset.stop = stop;

      if(spinMode === "W"){
          const targetSymbol = symbols[Math.floor(Math.random()*symbols.length)];
          const winLength = 3 + Math.floor(Math.random()*3); 
          const startRow = Math.floor(Math.random()*(rows - winLength + 1));
          for(let r=0;r<rows;r++){
              if(r >= startRow && r < startRow+winLength){
                  reel.children[stop+r].textContent = Math.random()<0.5 ? "üÉè" : targetSymbol;
              } else {
                  reel.children[stop+r].textContent = symbols[Math.floor(Math.random()*symbols.length)];
              }
          }
      } else if(spinMode === "L"){
          let lastSymbol = null, sameCount = 0;
          for(let r=0;r<rows;r++){
              let s;
              do { s = symbols[Math.floor(Math.random()*symbols.length)]; }
              while(s === lastSymbol && sameCount >= 2);
              reel.children[stop+r].textContent = s;
              if(s === lastSymbol) sameCount++; else sameCount=1;
              lastSymbol = s;
          }
      } else {
          for(let r=0;r<rows;r++)
              reel.children[stop+r].textContent = symbols[Math.floor(Math.random()*symbols.length)];
      }

      reel.style.transform=`translateY(-${stop*cellH}px)`;
  });

  setTimeout(()=>{ checkWin(); }, SPIN_DURATION);
}

// Glow reels
function highlightReelsGlow(){ reels.forEach((r,i)=>{ setTimeout(()=>r.parentElement.classList.add("hover"),i*80); setTimeout(()=>r.parentElement.classList.remove("hover"),i*50+200); }); }
function clearReelGlow(){ reels.forEach(r=>r.parentElement.classList.remove("hover")); }

// Check Win & Payout
function checkWin(){
  if(spinMode === "L") return;
  let payout=0;
  for(let r=0;r<rows;r++){
    let rowSymbols=[];
    for(let c=0;c<cols;c++){
      rowSymbols.push(reels[c].children[parseInt(reels[c].dataset.stop)+r].textContent);
    }

    let i=0;
    while(i<cols){
      let symbol=rowSymbols[i];
      let run=1, positions=[i];
      for(let j=i+1;j<cols;j++){
        if(rowSymbols[j]===symbol || rowSymbols[j]==="üÉè"){ run++; positions.push(j); }
        else break;
      }

      if(run>=3){
        payout += lineBonus[run];
        let sumSymbols=0;
        positions.forEach(p=>{ sumSymbols+=symbolPayout[rowSymbols[p]]; });
        payout += sumSymbols;

        animateWinRow(r, positions);

        let starCount = 0;
        positions.forEach(p => {
            if(rowSymbols[p]==="‚≠ê") starCount++;                  
            if(rowSymbols[p]==="üÉè" && symbol==="‚≠ê") starCount++; 
        });

        if(starCount >= 3){
            let baseFS = starCount === 3 ? 1 : starCount === 4 ? 2 : 5;
            if(extraFreeSpinEnabled) baseFS += 1;
            freeSpins += baseFS;
        }

        let wildCount = 0;
        positions.forEach(p => { if(rowSymbols[p]==="üÉè") wildCount++; });

        if(wildCount === 3) payout += 100000;
        else if(wildCount === 4) payout += 200000;
        else if(wildCount === 5) payout += 1000000;

        i += run;
      } else i++;
    }
  }

  if(payout>0){ balance+=payout; updateBalance(); showWinFloat("+"+payout); }
  updateFreeSpinDisplay();
}

// Animasi simbol menang
function animateWinRow(row, positions){
  positions.forEach(col=>{
    const cell = reels[col].children[parseInt(reels[col].dataset.stop)+row];
    cell.style.transition="transform 0.5s, color 0.5s";
    cell.style.transform="scale(1.5) rotateY(360deg)";
    cell.style.color="#00ff99";
    setTimeout(()=>{
      cell.style.transform="scale(1) rotateY(0deg)";
      cell.style.color="#fff";
    }, 500);
  });
}

function animateWinSymbol(cell){ cell.style.transition="transform 0.5s"; cell.style.transform="scale(1.5) rotateY(360deg)"; setTimeout(()=>cell.style.transform="scale(1) rotateY(0deg)",500); }
function highlightWinRow(row,start,end){ const div=document.createElement("div"); div.className="row-highlight"; div.style.top=row*cellH+"px"; div.style.left=(start*60)+"px"; div.style.width=((end-start+1)*60)+"px"; slot.appendChild(div); setTimeout(()=>div.remove(),SPIN_DURATION); }

function showWinFloat(text){
    const el = document.getElementById("winFloat");
    el.textContent = text;
    el.style.opacity = 1;
    el.style.transform = "translate(-50%, -35px)";
    setTimeout(()=>{
        el.style.opacity = 0;
        el.style.transform = "translate(-50%, 0)";
    }, 1000);
}

function updateBalance(){ balanceEl.textContent = formatBalance(balance); }
function formatBalance(value){
    if(value>=1_000_000_000) return (value/1_000_000_000).toFixed(1).replace(/\.0$/,'') + 'B';
    if(value>=1_000_000) return (value/1_000_000).toFixed(1).replace(/\.0$/,'') + 'M';
    if(value>=1000) return (value/1000).toFixed(1).replace(/\.0$/,'') + 'k';
    return value.toString();
}

function updateFreeSpinDisplay(){
    freeSpinDisplay.textContent = "Free Spins: " + freeSpins;

    if(freeSpins <= 0){
        useFreeSpin = false;
        toggleFreeSpinBtn.classList.remove('active');
        toggleFreeSpinBtn.textContent = "OFF";
        toggleFreeSpinBtn.disabled = true;
        toggleFreeSpinBtn.style.opacity = 0.5;
    } else {
        toggleFreeSpinBtn.disabled = false;
        toggleFreeSpinBtn.style.opacity = 1;
        toggleFreeSpinBtn.classList.toggle('active', useFreeSpin); 
        toggleFreeSpinBtn.textContent = useFreeSpin ? "ON" : "OFF";
    }
}

function highlightBalance(){ let count=0; const i=setInterval(()=>{ balanceEl.style.color=balanceEl.style.color==="red"?"":"red"; count++; if(count>=6){ clearInterval(i); balanceEl.style.color=""; } },50); }

updateBalance(); updateFreeSpinDisplay();
</script>
</body>
</html>

